<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>製品一覧 | Masahi Desu Works</title>
  <!-- mdw:meta-config
  {
    "title": "製品一覧 | Masahi Desu Works",
    "description": "macOS向けのプロダクティビティツールからハードウェアまで。ビルドを重ねてきたプロジェクトのスナップショットをこちらにまとめています。",
    "url": "https://masashi-desu.github.io/works/products/",
    "ogType": "website",
    "locale": "ja_JP",
    "alternateLocales": ["en_US"],
    "image": "https://masashi-desu.github.io/works/products/social/site-default.png",
    "imageAlt": "Masahi_desu Works の製品一覧ビジュアル",
    "imageWidth": 1200,
    "imageHeight": 630,
    "structuredData": {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "製品一覧 | Masahi Desu Works",
      "url": "https://masashi-desu.github.io/works/products/",
      "description": "macOS向けのプロダクティビティツールからハードウェアまで。ビルドを重ねてきたプロジェクトのスナップショットをこちらにまとめています。",
      "inLanguage": "ja"
    }
  }
  -->
  <!-- mdw:meta:start -->
  <meta name="description" content="macOS向けのプロダクティビティツールからハードウェアまで。ビルドを重ねてきたプロジェクトのスナップショットをこちらにまとめています。">
  <meta property="og:site_name" content="Masahi Desu Works">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="ja_JP">
  <meta property="og:locale:alternate" content="en_US">
  <meta property="og:title" content="製品一覧 | Masahi Desu Works">
  <meta property="og:description" content="macOS向けのプロダクティビティツールからハードウェアまで。ビルドを重ねてきたプロジェクトのスナップショットをこちらにまとめています。">
  <meta property="og:url" content="https://masashi-desu.github.io/works/products/">
  <meta property="og:image" content="https://masashi-desu.github.io/works/products/social/site-default.png">
  <meta property="og:image:alt" content="Masahi_desu Works の製品一覧ビジュアル">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:image" content="https://masashi-desu.github.io/works/products/social/site-default.png">
  <meta name="twitter:image:alt" content="Masahi_desu Works の製品一覧ビジュアル">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="製品一覧 | Masahi Desu Works">
  <meta name="twitter:description" content="macOS向けのプロダクティビティツールからハードウェアまで。ビルドを重ねてきたプロジェクトのスナップショットをこちらにまとめています。">
  <link rel="canonical" href="https://masashi-desu.github.io/works/products/">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "製品一覧 | Masahi Desu Works",
    "url": "https://masashi-desu.github.io/works/products/",
    "description": "macOS向けのプロダクティビティツールからハードウェアまで。ビルドを重ねてきたプロジェクトのスナップショットをこちらにまとめています。",
    "inLanguage": "ja"
  }
  </script>
  <!-- mdw:meta:end -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/modern-css-reset/dist/reset.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Outfit"', 'system-ui', 'sans-serif']
          },
          colors: {
            ink: '#0f172a',
            accent: '#38f9d7',
            glow: '#6366f1'
          }
        }
      }
    };
  </script>
  <link rel="stylesheet" href="../theme.css">
  <script>
    (function () {
      const root = document.documentElement;
      try {
        const stored = localStorage.getItem('mdw-theme');
        const preference = stored === 'light' || stored === 'dark' || stored === 'system' ? stored : 'system';
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const effective = preference === 'light' || preference === 'dark'
          ? preference
          : (prefersDark ? 'dark' : 'light');
        root.dataset.theme = effective;
        root.dataset.themePreference = preference;
      } catch (error) {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        root.dataset.theme = prefersDark ? 'dark' : 'light';
        root.dataset.themePreference = 'system';
      }
    })();
  </script>
</head>
<body class="min-h-screen bg-ink font-sans text-slate-100 antialiased relative overflow-x-hidden">
  <div class="pointer-events-none absolute inset-0 -z-10" data-transition-ignore>
    <div class="absolute -top-32 left-8 h-72 w-72 rounded-full bg-accent/30 blur-3xl"></div>
    <div class="absolute bottom-0 right-0 h-[28rem] w-[28rem] rounded-full bg-glow/30 blur-3xl"></div>
  </div>
  <main class="mx-auto flex max-w-6xl flex-col gap-12 px-6 py-16" data-transition-ignore>
    <header class="flex flex-col gap-4" data-transition-fade>
      <!-- 製品一覧 -->
      <p class="text-xs uppercase tracking-[0.35em] text-slate-400" data-i18n="sectionLabel">Product Portfolio</p>
      <h1 class="text-4xl font-semibold tracking-tight" data-i18n="sectionTitle">プロダクト一覧</h1>
      <p class="w-full text-base leading-relaxed text-slate-300" data-i18n="sectionBody">
        macOS向けのプロダクティビティツールからハードウェアまで。ビルドを重ねてきたプロジェクトのスナップショットをこちらにまとめています。
      </p>
    </header>
    <div id="product-controls" class="flex flex-col gap-4 rounded-3xl border border-white/10 bg-white/5 p-5 text-sm text-slate-200 shadow-2xl sm:flex-row sm:items-end sm:justify-between" data-transition-fade>
      <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:gap-6">
        <div class="flex flex-col gap-2">
          <span id="category-filter-label" class="text-xs uppercase tracking-[0.35em] text-slate-400" data-i18n="categoryFilterLabel">カテゴリ</span>
          <div class="relative">
            <select id="category-filter" class="min-w-[12rem] appearance-none rounded-2xl border border-white/10 bg-ink/60 pl-4 pr-12 py-3 text-sm text-white shadow-[0_12px_30px_rgba(15,23,42,0.45)] focus:border-white/40 focus:outline-none" aria-labelledby="category-filter-label">
            <option value="all">読み込み中...</option>
            </select>
            <span class="pointer-events-none absolute inset-y-0 right-4 flex items-center text-white/70">
              <svg class="h-4 w-4" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </span>
          </div>
        </div>
        <div class="flex flex-col gap-2">
          <span id="sort-order-label" class="text-xs uppercase tracking-[0.35em] text-slate-400" data-i18n="sortOrderLabel">並び替え</span>
          <div class="relative">
            <select id="sort-order" class="min-w-[12rem] appearance-none rounded-2xl border border-white/10 bg-ink/60 pl-4 pr-12 py-3 text-sm text-white shadow-[0_12px_30px_rgba(15,23,42,0.45)] focus:border-white/40 focus:outline-none" aria-labelledby="sort-order-label">
            <option value="date">読み込み中...</option>
            </select>
            <span class="pointer-events-none absolute inset-y-0 right-4 flex items-center text-white/70">
              <svg class="h-4 w-4" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </span>
          </div>
        </div>
      </div>
      <div class="text-xs uppercase tracking-[0.3em] text-slate-400">
        <span id="product-count">--</span>
      </div>
    </div>
    <div id="product-grid" class="grid gap-8 sm:grid-cols-2 xl:grid-cols-3" data-transition-fade data-lang-sensitive></div>
    <div class="flex flex-wrap items-center justify-between gap-6 text-sm text-slate-400" data-transition-fade>
      <a href="../index.html" data-transition-direction="left" class="inline-flex items-center gap-2 rounded-full border border-white/10 px-5 py-2 transition hover:border-white/30 hover:text-white" data-i18n="backHome">
        ← ホーム
      </a>
      <span class="text-xs tracking-widest uppercase" data-i18n-scope="updatedLabel">
        更新日: <time id="catalog-updated" class="text-slate-200"></time>
      </span>
    </div>
  </main>
  <footer class="mx-auto flex max-w-6xl flex-col gap-6 px-6 pb-10 text-xs text-slate-500 md:flex-row md:items-start md:justify-between">
    <span>© 2025 Masahi Desu Works</span>
    <div data-include="footer" data-footer-src="../partials/footer.html"></div>
  </footer>
  <script src="../theme.js"></script>
  <script src="../footer.js"></script>
  <script>
    (function () {
      const STORAGE_KEY = 'mdw-lang';
      const grid = document.getElementById('product-grid');
      const updated = document.getElementById('catalog-updated');
      const updatedScope = document.querySelector('[data-i18n-scope="updatedLabel"]');
      const controls = {
        wrapper: document.getElementById('product-controls'),
        category: document.getElementById('category-filter'),
        categoryLabel: document.getElementById('category-filter-label'),
        sort: document.getElementById('sort-order'),
        sortLabel: document.getElementById('sort-order-label'),
        count: document.getElementById('product-count')
      };
      const fallbackCopy = {};
      const localeConfig = {
        ja: {
          sectionLabel: 'Product Portfolio',
          sectionTitle: 'プロダクト一覧',
          sectionBody: 'macOS向けのプロダクティビティツールからハードウェアまで。ビルドを重ねてきたプロジェクトのスナップショットをこちらにまとめています。',
          backHome: '← ホーム',
          updatedLabel: '更新日: ',
          ctaExternal: '公式サイトへ',
          ctaInternal: '詳細を見る',
          themeLabel: 'テーマ',
          themeSystem: 'システム',
          themeLight: 'ライト',
          themeDark: 'ダーク',
          dateFormat: new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' }),
          updatedFormat: new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }),
          categoryFilterLabel: 'カテゴリ',
          sortOrderLabel: '並び替え',
          allCategoriesOption: 'すべて',
          sortOptionDate: '新しい順',
          sortOptionCategory: 'カテゴリ順',
          emptyState: '該当するプロダクトがありません。',
          formatResultCount: (shown, total) => `${shown}件表示 / 全${total}件`
        },
        en: {
          sectionLabel: 'Product Portfolio',
          sectionTitle: 'Products',
          sectionBody: 'From macOS productivity tools to experimental hardware—discover snapshots of the projects we keep iterating on.',
          backHome: '← Home',
          updatedLabel: 'Updated: ',
          ctaExternal: 'Visit Website',
          ctaInternal: 'View Details',
          themeLabel: 'Theme',
          themeSystem: 'System',
          themeLight: 'Light',
          themeDark: 'Dark',
          dateFormat: new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
          updatedFormat: new Intl.DateTimeFormat('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' }),
          categoryFilterLabel: 'Category',
          sortOrderLabel: 'Sort',
          allCategoriesOption: 'All categories',
          sortOptionDate: 'Newest first',
          sortOptionCategory: 'Category (A–Z)',
          emptyState: 'No products match this filter.',
          formatResultCount: (shown, total) => `Showing ${shown} of ${total}`
        }
      };

      let catalog = [];
      let currentLocale = resolveLocale(readStoredLanguage() || 'ja');
      let activeCategory = 'all';
      let activeSort = 'date';
      let dataLoaded = false;

      function readStoredLanguage() {
        try {
          return localStorage.getItem(STORAGE_KEY);
        } catch (error) {
          return null;
        }
      }

      function resolveLocale(locale) {
        return localeConfig[locale] ? locale : 'ja';
      }

      function recordFallbacks() {
        document.querySelectorAll('[data-i18n]').forEach((el) => {
          const key = el.getAttribute('data-i18n');
          if (!key || Object.prototype.hasOwnProperty.call(fallbackCopy, key)) {
            return;
          }
          fallbackCopy[key] = el.textContent.replace(/\s+$/u, '');
        });
      }

      function syncLanguageSelects(lang) {
        document.querySelectorAll('.lang-select').forEach((select) => {
          if (select.value !== lang) {
            select.value = lang;
          }
        });
      }

      function updateControlsLocale(lang) {
        const config = localeConfig[lang];
        if (controls.categoryLabel && config.categoryFilterLabel) {
          controls.categoryLabel.textContent = config.categoryFilterLabel;
        }
        if (controls.sortLabel && config.sortOrderLabel) {
          controls.sortLabel.textContent = config.sortOrderLabel;
        }
      }

      function refreshSortOptions(lang) {
        if (!controls.sort) {
          return;
        }
        const config = localeConfig[lang];
        const previous = controls.sort.value || activeSort || 'date';
        const optionDescriptors = [
          { value: 'date', label: config.sortOptionDate },
          { value: 'category', label: config.sortOptionCategory }
        ];
        controls.sort.innerHTML = '';
        optionDescriptors.forEach((descriptor) => {
          const option = document.createElement('option');
          option.value = descriptor.value;
          option.textContent = descriptor.label;
          controls.sort.appendChild(option);
        });
        const nextValue = optionDescriptors.some((descriptor) => descriptor.value === previous)
          ? previous
          : 'date';
        controls.sort.value = nextValue;
        activeSort = nextValue;
      }

      function refreshCategoryOptions(lang) {
        if (!controls.category) {
          return;
        }
        const config = localeConfig[lang];
        const discovered = new Set();
        catalog.forEach((item) => {
          if (!item || !Array.isArray(item.categories)) {
            return;
          }
          item.categories.forEach((category) => {
            if (category) {
              discovered.add(category);
            }
          });
        });
        const sortedCategories = Array.from(discovered).sort((a, b) => a.localeCompare(b, 'en', { sensitivity: 'base' }));
        const previous = controls.category.value || activeCategory || 'all';
        controls.category.innerHTML = '';
        const allOption = document.createElement('option');
        allOption.value = 'all';
        allOption.textContent = config.allCategoriesOption;
        controls.category.appendChild(allOption);
        sortedCategories.forEach((category) => {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = category;
          controls.category.appendChild(option);
        });
        const nextValue = previous === 'all' || sortedCategories.includes(previous)
          ? previous
          : 'all';
        controls.category.value = nextValue;
        activeCategory = nextValue;
      }

      function getFilteredCatalog() {
        const baseline = Array.isArray(catalog) ? catalog.slice() : [];
        const filtered = activeCategory === 'all'
          ? baseline
          : baseline.filter((item) => Array.isArray(item.categories) && item.categories.includes(activeCategory));
        const working = filtered.slice();
        if (activeSort === 'category') {
          working.sort((a, b) => {
            const categoryA = Array.isArray(a.categories) && a.categories.length > 0 ? a.categories[0] : '';
            const categoryB = Array.isArray(b.categories) && b.categories.length > 0 ? b.categories[0] : '';
            const primary = categoryA.localeCompare(categoryB, 'en', { sensitivity: 'base' });
            if (primary !== 0) {
              return primary;
            }
            const dateCompare = (b.date || '').localeCompare(a.date || '');
            if (dateCompare !== 0) {
              return dateCompare;
            }
            return (a.title_en || a.title || '').localeCompare(b.title_en || b.title || '', 'en', { sensitivity: 'base' });
          });
        } else {
          working.sort((a, b) => {
            const dateCompare = (b.date || '').localeCompare(a.date || '');
            if (dateCompare !== 0) {
              return dateCompare;
            }
            return (a.title_en || a.title || '').localeCompare(b.title_en || b.title || '', 'en', { sensitivity: 'base' });
          });
        }
        return working;
      }

      function updateResultCount(lang, shown) {
        if (!controls.count) {
          return;
        }
        const total = catalog.length;
        const config = localeConfig[lang];
        if (typeof config.formatResultCount === 'function') {
          controls.count.textContent = config.formatResultCount(shown, total);
        } else {
          controls.count.textContent = `${shown}/${total}`;
        }
      }

      function setupControls() {
        if (controls.category && controls.category.dataset.bound !== 'true') {
          controls.category.dataset.bound = 'true';
          controls.category.addEventListener('change', (event) => {
            activeCategory = event.target.value || 'all';
            renderCards(currentLocale);
          });
        }
        if (controls.sort && controls.sort.dataset.bound !== 'true') {
          controls.sort.dataset.bound = 'true';
          controls.sort.addEventListener('change', (event) => {
            activeSort = event.target.value || 'date';
            renderCards(currentLocale);
          });
        }
      }

      function renderCards(locale) {
        const lang = resolveLocale(locale);
        grid.innerHTML = '';
        const entries = getFilteredCatalog();

        if (entries.length === 0) {
          if (dataLoaded) {
            const emptyState = document.createElement('div');
            emptyState.className = 'col-span-full rounded-3xl border border-white/10 bg-white/5 p-10 text-center text-sm text-slate-400';
            emptyState.textContent = localeConfig[lang].emptyState;
            grid.appendChild(emptyState);
            updateResultCount(lang, 0);
          }
          return;
        }

        entries.forEach((item) => {
          const isExternal = item.url && item.url.trim() !== '';
          const link = document.createElement('a');
          let internalHref = `${item.dir || ''}`;
          if (!isExternal) {
            if (!/\.html?$/.test(internalHref)) {
              if (!internalHref.endsWith('/')) {
                internalHref = `${internalHref}/`;
              }
              internalHref = `${internalHref}index.html`;
            }
          }
          link.href = isExternal ? item.url : internalHref;
          link.className = 'group relative flex h-full flex-col overflow-hidden rounded-3xl border border-white/5 bg-white/5 p-6 shadow-2xl transition hover:border-white/20 hover:bg-white/10';
          link.setAttribute('data-transition-fade', 'true');
          link.dataset.pressable = 'true';
          if (isExternal) {
            link.target = '_blank';
            link.rel = 'noopener noreferrer';
          } else {
            link.dataset.transitionDirection = 'right';
          }

          const glow = document.createElement('div');
          glow.className = 'pointer-events-none absolute inset-x-0 top-0 h-24 -translate-y-16 rounded-full bg-accent/40 blur-3xl transition-opacity duration-500 group-hover:opacity-90';
          glow.style.zIndex = '-1';

          const baseTitle = item.title_en || item.title;
          const headerPath = (item.header || '').trim();
          const iconPath = (item.image || '').trim();
          let icon = null;
          if (iconPath) {
            icon = document.createElement('img');
            icon.src = `${item.dir}${iconPath}`;
            icon.alt = `${baseTitle} icon`;
          }

          const hasHeader = Boolean(headerPath);
          const hasIcon = Boolean(icon);
          const hasMedia = hasHeader || hasIcon;

          if (hasMedia) {
            const mediaWrapper = document.createElement('div');
            mediaWrapper.className = 'relative mb-4 h-40 w-full overflow-hidden rounded-2xl border border-white/10';
            mediaWrapper.dataset.mdwMedia = 'true';
            const observedImages = [];

            if (hasHeader) {
              const headerImg = document.createElement('img');
              headerImg.src = `${item.dir}${headerPath}`;
              headerImg.alt = `${baseTitle} header image`;
              headerImg.className = 'absolute inset-0 h-full w-full object-cover transition duration-500 group-hover:scale-105';
              headerImg.loading = 'lazy';
              observedImages.push(headerImg);
              mediaWrapper.appendChild(headerImg);
            } else {
              const placeholder = document.createElement('div');
              placeholder.className = 'absolute inset-0 bg-gradient-to-br from-slate-900/50 via-slate-800/40 to-slate-900/60';
              mediaWrapper.appendChild(placeholder);
            }

            if (hasIcon) {
              const iconBadge = document.createElement('div');
              iconBadge.className = 'absolute bottom-4 left-4 z-30 flex h-16 w-16 items-center justify-center rounded-2xl border border-white/20 bg-transparent p-2 shadow-[0_12px_30px_rgba(15,23,42,0.45)] backdrop-blur-lg transition duration-300';
              icon.className = 'h-12 w-12 rounded-xl object-cover';
              icon.loading = 'lazy';
              observedImages.push(icon);
              iconBadge.appendChild(icon);
              mediaWrapper.appendChild(iconBadge);
            }

            if (observedImages.length > 0 && window.MDWMediaLoader && typeof window.MDWMediaLoader.attach === 'function') {
              window.MDWMediaLoader.attach(mediaWrapper, { targets: observedImages });
            }

            link.appendChild(mediaWrapper);
          }

          const title = document.createElement('h2');
          title.textContent = lang === 'en' ? (item.title_en || item.title) : (item.title_ja || item.title);
          title.className = 'text-2xl font-semibold text-white';
          if (hasMedia) {
            title.classList.add('mt-4');
          } else {
            title.classList.add('mt-2');
          }

          const desc = document.createElement('p');
          desc.textContent = lang === 'en' ? (item.desc_en || item.desc) : (item.desc_ja || item.desc);
          desc.className = 'mt-3 text-sm leading-relaxed text-slate-300';

          const categories = item.categories;
          let tagList = null;
          if (Array.isArray(categories) && categories.length > 0) {
            tagList = document.createElement('div');
            tagList.className = 'mt-4 flex flex-wrap gap-2';
            categories.forEach((category) => {
              if (!category) {
                return;
              }
              const tag = document.createElement('span');
              tag.textContent = category;
              tag.className = 'inline-flex items-center rounded-full border border-white/10 bg-white/10 px-3 py-1 text-xs font-medium text-white/80 backdrop-blur';
              tagList.appendChild(tag);
            });
          }

          const date = document.createElement('time');
          date.dateTime = item.date;
          date.textContent = localeConfig[lang].dateFormat.format(new Date(item.date));
          date.className = 'mt-6 text-xs uppercase tracking-[0.3em] text-slate-400';

          const cta = document.createElement('span');
          cta.className = 'mt-6 inline-flex items-center gap-2 text-sm font-medium text-accent transition group-hover:gap-3';
          cta.textContent = isExternal ? localeConfig[lang].ctaExternal : localeConfig[lang].ctaInternal;

          const arrow = document.createElement('span');
          arrow.textContent = isExternal ? '↗' : '→';
          arrow.className = 'transition-transform group-hover:translate-x-1';
          cta.appendChild(arrow);

          link.appendChild(glow);
          link.appendChild(title);
          link.appendChild(desc);
          if (tagList) {
            link.appendChild(tagList);
          }
          link.appendChild(date);
          link.appendChild(cta);
          grid.appendChild(link);
        });

        updateResultCount(lang, entries.length);

        if (window.mdwTheme && typeof window.mdwTheme.focusPressables === 'function') {
          window.mdwTheme.focusPressables(grid);
        }

        updated.textContent = localeConfig[lang].updatedFormat.format(new Date());
        updatedScope.textContent = `${localeConfig[lang].updatedLabel}`;
        updatedScope.appendChild(updated);
      }

      function updateLanguage(locale) {
        recordFallbacks();
        const lang = resolveLocale(locale);
        currentLocale = lang;
        document.documentElement.lang = lang;
        document.querySelectorAll('[data-i18n]').forEach((el) => {
          const key = el.getAttribute('data-i18n');
          if (!key) {
            return;
          }
          if (lang === 'ja') {
            const fallback = fallbackCopy[key];
            if (typeof fallback === 'string') {
              el.textContent = fallback;
            }
          } else {
            const copy = localeConfig[lang][key];
            if (typeof copy === 'string') {
              el.textContent = copy;
            } else {
              const fallback = fallbackCopy[key];
              if (typeof fallback === 'string') {
                el.textContent = fallback;
              }
            }
          }
        });
        updateControlsLocale(lang);
        refreshSortOptions(lang);
        refreshCategoryOptions(lang);
        syncLanguageSelects(lang);
        try {
          localStorage.setItem(STORAGE_KEY, lang);
        } catch (error) {
          /* ignore */
        }
        renderCards(lang);
        return lang;
      }

      const controller = window.MDWLanguageTransition
        ? window.MDWLanguageTransition.create((lang) => updateLanguage(lang), { duration: 320 })
        : null;

      function applyLanguage(locale, options = {}) {
        const target = resolveLocale(locale);
        if (controller) {
          controller.apply(target, options);
        } else {
          updateLanguage(target);
        }
      }

      function setupLanguageSelector() {
        document.querySelectorAll('.lang-select').forEach((select) => {
          if (select.dataset.bound === 'true') {
            select.value = currentLocale;
            return;
          }
          select.dataset.bound = 'true';
          select.addEventListener('change', (event) => {
            applyLanguage(event.target.value, { animate: true });
          });
          select.value = currentLocale;
        });
      }

      window.addEventListener('mdw:footer-loaded', () => {
        setupControls();
        setupLanguageSelector();
        applyLanguage(currentLocale);
      });

      setupControls();
      applyLanguage(currentLocale);
      setupLanguageSelector();

      fetch('index.json')
        .then((response) => {
          if (!response.ok) {
            throw new Error('index.json の読み込みに失敗しました');
          }
          return response.json();
        })
        .then((items) => {
          catalog = items;
          dataLoaded = true;
          applyLanguage(currentLocale);
        })
        .catch((error) => {
          dataLoaded = true;
          const notice = document.createElement('div');
          notice.className = 'rounded-3xl border border-red-500/40 bg-red-500/10 p-6 text-sm text-red-200 backdrop-blur';
          notice.textContent = error.message;
          grid.replaceWith(notice);
        });
    })();
  </script>
</body>
</html>
